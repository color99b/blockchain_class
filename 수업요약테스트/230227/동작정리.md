# 실행 순서

1. wsl의 home에서 아래 구문으로 new genesis 생성

```sh
sudo vi ./newGenesis.json
```

2. newGenesis.json 에 아래 내용 입력 (chainId는 너무 길지만 않게 랜덤 짧으면 블록 초기화 확률이 높아짐(겹쳐서))

```json
{
  "difficulty": "200000",
  "gasLimit": "3100000",
  "alloc": {},
  "config": {
    "chainId": 61232450,
    "homesteadBlock": 0,
    "eip150Block": 0,
    "eip155Block": 0,
    "eip158Block": 0,
    "byzantiumBlock": 0,
    "constantinopleBlock": 0
  }
}
```

3. geth 서버 만들기

```sh
geth --datadir newGeth init newGenesis.json    // newGeth 는 생성할 폴더명
```

home 폴더속에 폴더명대로 잘 생성이 되었으면 완료.
이 단계에서 오류가 나면 거의 json 오타임

4. extenstion 에서 solidity설치후 아래 문 실행

```sh
npm i -D prettier-plugin-solidity
```

5. setting.json 에 아래 내용 추가

```json
{
  "prettier.documentSelectors": ["**/*.sol"]
}
```

6. solidity 작성

```solidity
// SPDX-License-Identifier: MIT
// 라이선스 표기 주석아니고 필요한 문장이다.
pragma solidity ^0.8.15;

//솔리디티 버전 설정
contract Test {
  // contract : js 에서의 class 와 같다.
  string text;

  constructor() {
    text = "Hi Block7";
  }

  function getText() public view returns (string memory) {
    // public : 외부에서 사용가능한 데이터
    // view : 읽기 전용 데이터 처리
    // returns : 반환하는 데이터
    // memory : 함수 내에서만 변수 사용, 데이터를 외부에 저장하지 않음(지역 변수처리) (없어도 된다.)
    return text;
  }

  function setText(string memory _value) public {
    text = _value;
  }
}
```

# 컴파일

```sh
npm i solc
npx solc --bin --abi ./test.sol
```

- solc : Solidity Compiler
  -- bin : binary, transaction 에 저장되는 실제 ByteCode
  - solidity 등 우리가 작성한 코드를 Evm 에서 실행할 수 있는 ByteCode로 변환(컴파일)
  - 해당 ByteCode는 트랜잭션에 저장되고, 해당 코드를 receipt 내의 contractAddress 로 찾음
    -- abi : Application Binary Interface, 스마트 컨트랙트 내의 함수와 매개변수 등을 json 형식으로표기
    - abi 는 데이터의 정확한 매칭(인코딩) 을 위해서 사용
    - 어떤어떤 데이터 (변수, 함수, 메서드, 프로퍼티) 가 있는지 미리 정해두고 맞춘다.

# 스마트 컨트랙트 트랜잭션으로 보내기

1. 편의를 위해 변수 선언
   (terminal에서 geth attach localhost :포트번호) 쪽에서 아래 문장 실행.
   // solc로 생성된 bin 파일 내의 모든 데이터
   //data = "0x" + solc로 생성된 bin 파일내 모든 데이터

```js
data =
  "0x60806040523480156200001157600080fd5b506040518060400160405280600981526020017f486920426c6f636b37000000000000000000000000000000000000000000000081525060009081620000589190620002d9565b50620003c0565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680620000e157607f821691505b602082108103620000f757620000f662000099565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302620001617fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8262000122565b6200016d868362000122565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b6000620001ba620001b4620001ae8462000185565b6200018f565b62000185565b9050919050565b6000819050919050565b620001d68362000199565b620001ee620001e582620001c1565b8484546200012f565b825550505050565b600090565b62000205620001f6565b62000212818484620001cb565b505050565b5b818110156200023a576200022e600082620001fb565b60018101905062000218565b5050565b601f82111562000289576200025381620000fd565b6200025e8462000112565b810160208510156200026e578190505b620002866200027d8562000112565b83018262000217565b50505b505050565b600082821c905092915050565b6000620002ae600019846008026200028e565b1980831691505092915050565b6000620002c983836200029b565b9150826002028217905092915050565b620002e4826200005f565b67ffffffffffffffff8111156200030057620002ff6200006a565b5b6200030c8254620000c8565b620003198282856200023e565b600060209050601f8311600181146200035157600084156200033c578287015190505b620003488582620002bb565b865550620003b8565b601f1984166200036186620000fd565b60005b828110156200038b5784890151825560018201915060208501945060208101905062000364565b86831015620003ab5784890151620003a7601f8916826200029b565b8355505b6001600288020188555050505b505050505050565b61067c80620003d06000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c80635d3a1f9d1461003b578063e00fe2eb14610057575b600080fd5b61005560048036038101906100509190610274565b610075565b005b61005f610088565b60405161006c919061033c565b60405180910390f35b80600090816100849190610574565b5050565b6060600080546100979061038d565b80601f01602080910402602001604051908101604052809291908181526020018280546100c39061038d565b80156101105780601f106100e557610100808354040283529160200191610110565b820191906000526020600020905b8154815290600101906020018083116100f357829003601f168201915b5050505050905090565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61018182610138565b810181811067ffffffffffffffff821117156101a05761019f610149565b5b80604052505050565b60006101b361011a565b90506101bf8282610178565b919050565b600067ffffffffffffffff8211156101df576101de610149565b5b6101e882610138565b9050602081019050919050565b82818337600083830152505050565b6000610217610212846101c4565b6101a9565b90508281526020810184848401111561023357610232610133565b5b61023e8482856101f5565b509392505050565b600082601f83011261025b5761025a61012e565b5b813561026b848260208601610204565b91505092915050565b60006020828403121561028a57610289610124565b5b600082013567ffffffffffffffff8111156102a8576102a7610129565b5b6102b484828501610246565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b838110156102f75780820151818401526020810190506102dc565b60008484015250505050565b600061030e826102bd565b61031881856102c8565b93506103288185602086016102d9565b61033181610138565b840191505092915050565b600060208201905081810360008301526103568184610303565b905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806103a557607f821691505b6020821081036103b8576103b761035e565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026104207fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826103e3565b61042a86836103e3565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b600061047161046c61046784610442565b61044c565b610442565b9050919050565b6000819050919050565b61048b83610456565b61049f61049782610478565b8484546103f0565b825550505050565b600090565b6104b46104a7565b6104bf818484610482565b505050565b5b818110156104e3576104d86000826104ac565b6001810190506104c5565b5050565b601f821115610528576104f9816103be565b610502846103d3565b81016020851015610511578190505b61052561051d856103d3565b8301826104c4565b50505b505050565b600082821c905092915050565b600061054b6000198460080261052d565b1980831691505092915050565b6000610564838361053a565b9150826002028217905092915050565b61057d826102bd565b67ffffffffffffffff81111561059657610595610149565b5b6105a0825461038d565b6105ab8282856104e7565b600060209050601f8311600181146105de57600084156105cc578287015190505b6105d68582610558565b86555061063e565b601f1984166105ec866103be565b60005b82811015610614578489015182556001820191506020850194506020810190506105ef565b86831015610631578489015161062d601f89168261053a565b8355505b6001600288020188555050505b50505050505056fea2646970667358221220da558d65041386312d94e10035dafb4ef8250f26fb11e3bce54f3df79950c65064736f6c63430008130033";
// solc로 생성된 bin 파일 내의 모든 데이터
txObj = { from: eth.accounts[0], data, gas: 1000000 };
```

2. 트랜잭션 보내기

```sh
eth.sendTransaction(txObj);
// miner.start()
// miner.stop()
```

3. 트랜잭션 확인하기 (port 열어놓은 터미널에 transaction 이 생성되었을때 hash와 간단한 정보는 표시됨 그걸로 조회)

```sh
eth.getTransaction("0xe439739c1b5d4c7162522ddc436fdc6f7956eef9047d1eddb30d165052aeefe4"); //1
eth.getTransactionReceipt("0x29a1fd5fda26e88fea9cd8b5eb47467ed79eb111883e53149cd18cf4efb6990c");   //2

```

1번은 txpool 에서 찾을 수 있고
2번은 mining 이 되야만 찾을수 있다.

결과

```sh

> eth.getTransaction("0x01d9ec72055258174446b06ec67b05dfbb797f4c921fb6d9fcfeb7a6e498126c");
{
  blockHash: "0x7d8d25e557b89c3e3dbffc0f23ccf7790452109124f2af262e39831b1036a4f6",
  blockNumber: 1508,
  chainId: "0x3a65542",
  from: "0x422b6375e61e799a15db4f00f5bfe9f89c2cb04f",
  gas: 1000000,
  gasPrice: 1000000000,
  hash: "0x01d9ec72055258174446b06ec67b05dfbb797f4c921fb6d9fcfeb7a6e498126c",
  input: "0x60806040523480156200001157600080fd5b506040518060400160405280600981526020017f486920426c6f636b37000000000000000000000000000000000000000000000081525060009081620000589190620002d9565b50620003c0565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680620000e157607f821691505b602082108103620000f757620000f662000099565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302620001617fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8262000122565b6200016d868362000122565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b6000620001ba620001b4620001ae8462000185565b6200018f565b62000185565b9050919050565b6000819050919050565b620001d68362000199565b620001ee620001e582620001c1565b8484546200012f565b825550505050565b600090565b62000205620001f6565b62000212818484620001cb565b505050565b5b818110156200023a576200022e600082620001fb565b60018101905062000218565b5050565b601f82111562000289576200025381620000fd565b6200025e8462000112565b810160208510156200026e578190505b620002866200027d8562000112565b83018262000217565b50505b505050565b600082821c905092915050565b6000620002ae600019846008026200028e565b1980831691505092915050565b6000620002c983836200029b565b9150826002028217905092915050565b620002e4826200005f565b67ffffffffffffffff8111156200030057620002ff6200006a565b5b6200030c8254620000c8565b620003198282856200023e565b600060209050601f8311600181146200035157600084156200033c578287015190505b620003488582620002bb565b865550620003b8565b601f1984166200036186620000fd565b60005b828110156200038b5784890151825560018201915060208501945060208101905062000364565b86831015620003ab5784890151620003a7601f8916826200029b565b8355505b6001600288020188555050505b505050505050565b61067c80620003d06000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c80635d3a1f9d1461003b578063e00fe2eb14610057575b600080fd5b61005560048036038101906100509190610274565b610075565b005b61005f610088565b60405161006c919061033c565b60405180910390f35b80600090816100849190610574565b5050565b6060600080546100979061038d565b80601f01602080910402602001604051908101604052809291908181526020018280546100c39061038d565b80156101105780601f106100e557610100808354040283529160200191610110565b820191906000526020600020905b8154815290600101906020018083116100f357829003601f168201915b5050505050905090565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61018182610138565b810181811067ffffffffffffffff821117156101a05761019f610149565b5b80604052505050565b60006101b361011a565b90506101bf8282610178565b919050565b600067ffffffffffffffff8211156101df576101de610149565b5b6101e882610138565b9050602081019050919050565b82818337600083830152505050565b6000610217610212846101c4565b6101a9565b90508281526020810184848401111561023357610232610133565b5b61023e8482856101f5565b509392505050565b600082601f83011261025b5761025a61012e565b5b813561026b848260208601610204565b91505092915050565b60006020828403121561028a57610289610124565b5b600082013567ffffffffffffffff8111156102a8576102a7610129565b5b6102b484828501610246565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b838110156102f75780820151818401526020810190506102dc565b60008484015250505050565b600061030e826102bd565b61031881856102c8565b93506103288185602086016102d9565b61033181610138565b840191505092915050565b600060208201905081810360008301526103568184610303565b905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806103a557607f821691505b6020821081036103b8576103b761035e565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026104207fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826103e3565b61042a86836103e3565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b600061047161046c61046784610442565b61044c565b610442565b9050919050565b6000819050919050565b61048b83610456565b61049f61049782610478565b8484546103f0565b825550505050565b600090565b6104b46104a7565b6104bf818484610482565b505050565b5b818110156104e3576104d86000826104ac565b6001810190506104c5565b5050565b601f821115610528576104f9816103be565b610502846103d3565b81016020851015610511578190505b61052561051d856103d3565b8301826104c4565b50505b505050565b600082821c905092915050565b600061054b6000198460080261052d565b1980831691505092915050565b6000610564838361053a565b9150826002028217905092915050565b61057d826102bd565b67ffffffffffffffff81111561059657610595610149565b5b6105a0825461038d565b6105ab8282856104e7565b600060209050601f8311600181146105de57600084156105cc578287015190505b6105d68582610558565b86555061063e565b601f1984166105ec866103be565b60005b82811015610614578489015182556001820191506020850194506020810190506105ef565b86831015610631578489015161062d601f89168261053a565b8355505b6001600288020188555050505b50505050505056fea2646970667358221220c4e34717fe4e1e7bfa8c892b8a587dd3b04a38dbce46bf0835510779b0b97a6464736f6c63430008130033",
  nonce: 0,
  r: "0x4063a328fb25dfc8e760fedc0adc225900bfada672dccdb99cc711e1f12cd65a",
  s: "0x1c80b437206b01a8241651f3381cf1fe70a630360968ee48a2a47feb0e054955",
  to: null,
  transactionIndex: 0,
  type: "0x0",
  v: "0x74caaa7",
  value: 0
}




> eth.getTransactionReceipt("0x01d9ec72055258174446b06ec67b05dfbb797f4c921fb6d9fcfeb7a6e498126c");
{
  blockHash: "0x7d8d25e557b89c3e3dbffc0f23ccf7790452109124f2af262e39831b1036a4f6",
  blockNumber: 1508,
  contractAddress: "0x1e658c97530770dd8bffdf41e824ede9c0083db6",
  cumulativeGasUsed: 565399,
  effectiveGasPrice: 1000000000,
  from: "0x422b6375e61e799a15db4f00f5bfe9f89c2cb04f",
  gasUsed: 565399,
  logs: [],
  logsBloom: "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
  status: "0x1",
  to: null,
  transactionHash: "0x01d9ec72055258174446b06ec67b05dfbb797f4c921fb6d9fcfeb7a6e498126c",
  transactionIndex: 0,
  type: "0x0"
}
```

- contractAddress : CA
  -CA : 스마트 컨트랙트에 대한 주소
  -EOA : Externally Owned Account : 지갑주소

4. 컨트랙트 생성(연결) : 매개변수로 abi로 추출된 데이터를 통째로 입력한다.

```js
contract = eth.contract([
  { inputs: [], stateMutability: "nonpayable", type: "constructor" },
  {
    inputs: [
      { internalType: "int256", name: "_num", type: "int256" },
      { internalType: "int256", name: "_num2", type: "int256" },
    ],
    name: "add",
    outputs: [],
    stateMutability: "nonpayable",
    type: "function",
  },
  {
    inputs: [],
    name: "getResult",
    outputs: [{ internalType: "int256", name: "", type: "int256" }],
    stateMutability: "view",
    type: "function",
  },
  {
    inputs: [],
    name: "getText",
    outputs: [{ internalType: "string", name: "", type: "string" }],
    stateMutability: "view",
    type: "function",
  },
  {
    inputs: [
      { internalType: "int256", name: "_num", type: "int256" },
      { internalType: "int256", name: "_num2", type: "int256" },
    ],
    name: "minus",
    outputs: [],
    stateMutability: "nonpayable",
    type: "function",
  },
  {
    inputs: [{ internalType: "string", name: "_value", type: "string" }],
    name: "setText",
    outputs: [],
    stateMutability: "nonpayable",
    type: "function",
  },
]);
```

5. 컨트랙트에 CA 연결

```sh
instance = contract.at("0xe6f8fb4ea4349110e835693401dba245eeb22e48");
```

- at메서드를 호출하며 ContractAddress 를 매개변수로 전달
- 앞으로 스마트 컨트랙트 실행시 instance 변수를 사용

6. 컨트랙트 실행하여 확인

```sh

```

solidity 에서 작성해둔 getText 메서드를 호출한다.

7. set method

```sh
instance.setText("why so serious", {from:eth.accounts[0]})
instance.minus(1,5 , {from:eth.accounts[0]})

# 돈이 들어있는 계정
```

- 첫 번째 매개변수로 값을 보내고, 두번 째 매개변수로 트랜잭션의 내용 전달
- 데이터가 바뀌었기 때문에 채굴을 통해 블록을 생성하여 적용한다.

# EVM은 무료일까?

- 유료이기때문에 가스비가 필요하다.
- EVM은 왜 유료일까? -> 다른 컴퓨터 쓰는데 무료로 쓸 수 있을까? + 잦은 변경을 막기 위해
- 이더리움 블록체인 네트워크에 node(peer)가 하나일까? -> 하나면 해킹이 쉬워진다.

---

# ganache

1. bash home에서 npm i -g ganache (기본 포트번호는 8545)

2. 다른 bash 하나를 더 열고 geth attach http://localhost:8545

3. 위에서 했던 내용(2번부터 쭉) 그대로 반복

4. abi 전송하면 accounts 에 ganache 에 있던 계정 목록이 쭉 나열됨.
